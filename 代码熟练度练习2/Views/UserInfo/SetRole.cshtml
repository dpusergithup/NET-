@*@model 代码熟练度练习2.RoleInfo*@
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>SetRole</title>
    <script src="~/Content/jqueryeasyui/jquery-3.0.0.min.js"></script>
    <script src="~/Content/jqueryeasyui/jquery.easyui.min.js"></script>
    <link href="~/Content/jqueryeasyui/themes/icon.css" rel="stylesheet" />
    <script src="~/Content/jqueryeasyui/locale/easyui-lang-zh_CN.js"></script>
    <script src="~/Scripts/jquery.unobtrusive-ajax.js"></script>
    <link href="~/Content/jqueryeasyui/themes/default/easyui.css" rel="stylesheet" />
    <script type="text/javascript">
        function formSubmit() {
            $('form').submit();
        }

        function afterSetRole(data) {
            if (data == "OK") {
                window.parent.window.afterSetRole();//调用父容器的方法
            } else {
                alert("失败了");
            }
        }
    </script>
</head>
<body>
    @{UserInfo ui = ViewBag.user;
    }
    <h3>给当前用户：@ui.UName 设置角色</h3>
    @{
        //获取当前用户的角色
        List<int> lid = ViewBag.AllRole;

        using (Ajax.BeginForm("ProcessSetRole", "UserInfo", new AjaxOptions() { OnSuccess = "afterSetRole" }))
        {
            <input type="hidden" name="UId" value="@ui.Id" />
            int i = 0;
            foreach (var roleinfo in Model)
            {
                string str = "ckb_" + roleinfo.Id;

                if (i % 2 == 0 && i != 0)
                {
                    <hr />
                }

                if (lid.Contains(roleinfo.Id))
                {

                    <input type="checkbox" checked="checked" value="@str" name="@str" id="@str" />
                }
                else
                {
                    <input type="checkbox" value="@str" name="@str" id="@str" />
                }

                <label for="@str">@roleinfo.RoleName</label>

                i++;
            }
        }
    }}
    <div> 
    </div>
</body>
</html>
